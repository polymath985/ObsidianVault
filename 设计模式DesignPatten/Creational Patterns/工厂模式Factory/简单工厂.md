---
tags:
  - 设计模式
  - CSharp
---
# 简单工厂

简单工厂又叫做静态[[工厂方法模式]]

```csharp
// 产品接口
public interface IDatabase
{
    void Connect();
    void ExecuteQuery(string query);
    void Close();
}

// 具体产品类
public class SqlServerDatabase : IDatabase
{
    public void Connect() { Console.WriteLine("Connecting to SQL Server..."); }
    public void ExecuteQuery(string query) { Console.WriteLine($"SQL Server executing: {query}"); }
    public void Close() { Console.WriteLine("SQL Server connection closed."); }
}

public class MySqlDatabase : IDatabase
{
    public void Connect() { Console.WriteLine("Connecting to MySQL..."); }
    public void ExecuteQuery(string query) { Console.WriteLine($"MySQL executing: {query}"); }
    public void Close() { Console.WriteLine("MySQL connection closed."); }
}

public class OracleDatabase : IDatabase
{
    public void Connect() { Console.WriteLine("Connecting to Oracle..."); }
    public void ExecuteQuery(string query) { Console.WriteLine($"Oracle executing: {query}"); }
    public void Close() { Console.WriteLine("Oracle connection closed."); }
}
```

在下图的`SqlHelper`中，通过对操作对象的隔离，使得其不需要关心数据库的具体类型，从而是自身行为更加稳定

```csharp
// 执行行为类 - 不需要关心具体的数据库类型
public class SqlHelper
{
    private IDatabase database;
    
    public SqlHelper(string dbType)
    {
        // 通过工厂获取数据库实例
        database = DatabaseFactory.CreateDatabase(dbType);
    }
    
    public void ExecuteOperation(string query)
    {
        database.Connect();
        database.ExecuteQuery(query);
        database.Close();
    }
}
```
*图：执行行为类*

```csharp
// 简单工厂类
public class DatabaseFactory
{
    public static IDatabase CreateDatabase(string dbType)
    {
        switch (dbType.ToLower())
        {
            case "sqlserver":
                return new SqlServerDatabase();
            case "mysql":
                return new MySqlDatabase();
            case "oracle":
                return new OracleDatabase();
            default:
                throw new ArgumentException("Unsupported database type");
        }
    }
}
```
*图：工厂类*

```csharp
// 客户端使用示例
class Program
{
    static void Main(string[] args)
    {
        // 通过配置或参数指定数据库类型
        string dbType = ConfigurationManager.AppSettings["DatabaseType"]; // 可以是 "sqlserver", "mysql", "oracle"
        
        SqlHelper helper = new SqlHelper(dbType);
        helper.ExecuteOperation("SELECT * FROM Users");
        
        // 可以轻松切换数据库类型而不修改业务逻辑
        SqlHelper mysqlHelper = new SqlHelper("mysql");
        mysqlHelper.ExecuteOperation("SELECT * FROM Products");
    }
}
```

## 优缺点

- ### 优点
	  - 实现了对责任的分割，隔离了变化
	  -  通过配置文件，可以在不修改任何客户端代码的清空下更换和新加新的具体产品类，在一定程度上提高了系统的灵活性
- ### 缺点
	  - 集中了所有实例的创建逻辑，违背了单一职责原则
	  - 扩展困难，一旦添加新产品就不得不修改工厂逻辑，违背了开闭原则